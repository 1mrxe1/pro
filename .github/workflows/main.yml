name: Python Bot (Stop Test)

on:
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
          fi

      # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª Ø«Ù… Ø¥ÙŠÙ‚Ø§ÙÙ‡ Ø¨Ø¹Ø¯ 10 Ø¯Ù‚Ø§Ø¦Ù‚ ÙÙ‚Ø·
      - name: Run bot with shutdown test
        run: |
          echo "ðŸš€ Starting bot..."

          # ðŸŸ¢ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 1: PID tracking
          python main.py > bot.log 2>&1 &
          BOT_PID=$!

          sleep 600   # 10 Ø¯Ù‚Ø§Ø¦Ù‚

          echo "ðŸ›‘ Sending SIGTERM to bot..."
          kill -TERM $BOT_PID || true
          sleep 5
          kill -9 $BOT_PID 2>/dev/null || true
          echo "âœ… Bot stopped (PID tracking)."

          # ðŸŸ¢ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 2: timeout (Ø¨Ø¯ÙŠÙ„)
          # echo "ðŸš€ Starting bot with timeout..."
          # timeout -s TERM 600 python main.py > bot.log 2>&1 || true
          # echo "âœ… Bot stopped (timeout)."

      - name: Show bot logs
        run: cat bot.log
